@using ProjectChapeau.Models.Enums
@model ProjectChapeau.Views.ViewModel.TableOrderModel


@foreach (RestaurantTable table in Model.restaurantTables)
{
    Order latestOrder = Model.Orders.Where(o => o.tableId.TableNumber == table.TableNumber).OrderByDescending(o => o.datetime).FirstOrDefault();

    bool isOccupied = latestOrder != null && latestOrder.orderStatus != OrderStatus.Completed;

    string cardColor = table.IsOccupied ? "bg-danger text-white" : "bg-success text-white";
    string statusText = table.IsOccupied ? "Occupied" : "Available";

    <div class="col">
        <div class="card h-100 shadow-sm border-0 @cardColor">
            <div class="card-body d-flex flex-column justify-content-center text-center">
                <h5 class="card-title">Table @table.TableNumber</h5>
                <p class="card-text mb-3">Status: <strong>@statusText</strong></p>
                @if (latestOrder != null)
                {
                    <p class="card-text">Last Order #: <strong>@latestOrder.orderId</strong></p>
                    <p class="card-text">Order Status: <strong>@latestOrder.orderStatus</strong></p>
                }
                else
                {
                    <p class="card-text text-muted">No orders yet</p>
                }

            </div>
        </div>
    </div>
}